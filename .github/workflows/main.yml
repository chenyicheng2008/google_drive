name: Google Drive Download Workflow # çµ¦æ‚¨çš„å·¥ä½œæµç¨‹ä¸€å€‹åç¨±

on: 
  push:
    branches: [ main ] # è¨­å®šåœ¨ push åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼æ­¤æµç¨‹
  workflow_dispatch: # å…è¨±æ‰‹å‹•é»æ“ŠæŒ‰éˆ•è§¸ç™¼æ­¤æµç¨‹

jobs: # <-- æ–°å¢ï¼šæ‰€æœ‰å·¥ä½œå®šç¾©çš„é–‹å§‹
  run_script: # <-- æ–°å¢ï¼šå®šç¾©ä¸€å€‹å…·é«”çš„å·¥ä½œ (Job)
    runs-on: ubuntu-latest # å®šç¾©åŸ·è¡Œç’°å¢ƒ

    steps: # <-- æ‚¨çš„æ‰€æœ‰æ­¥é©Ÿç¾åœ¨åœ¨é€™å€‹ Job ä¹‹ä¸‹
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install PyDrive2

      - name: Authenticate and Download Data from Drive
        env:
          GDRIVE_CREDENTIALS: ${{ secrets.GDRIVE_CREDENTIALS }} # å¾ Secrets è®€å–æ†‘è­‰
        run: |
          echo "$GDRIVE_CREDENTIALS" | base64 -d > client_secrets.json # å°‡ Secrets å¯«å…¥æª”æ¡ˆ

  # âœ…ã€é—œéµæ–°å¢ã€‘å»ºç«‹ PyDrive2 è¨­å®šæª”
      - name: Create PyDrive2 settings.yaml
        run: |
          cat <<EOF > settings.yaml
          client_config_backend: service
          service_config:
            client_json_file_path: client_secrets.json
            client_json_backend: file
          save_credentials: False
          EOF

      - name: Install dependencies
        run: |
          # 1. PyDrive2 ç”¨æ–¼ Google Drive èªè­‰å’Œä¸‹è¼‰
          pip install PyDrive2
          # 2. Papermill ç”¨æ–¼åŸ·è¡Œ Colab ç­†è¨˜æœ¬
          pip install papermill
          # 3. å¦‚æœæ‚¨çš„ Colab ç­†è¨˜æœ¬éœ€è¦å…¶ä»–å¥—ä»¶ï¼Œä¹Ÿæ‡‰åœ¨æ­¤è™•å®‰è£
          # pip install numpy pandas requests

      - name: Install dependencies and Register Kernel
        run: |
          # 1. PyDrive2 å’Œ Papermill
          # pip install PyDrive2 papermill
          
          # 2. ã€é—œéµæ–°å¢ã€‘å®‰è£ ipykernel
          pip install ipykernel
          
          # 3. ã€é—œéµæ–°å¢ã€‘è¨»å†Š 'python3' æ ¸å¿ƒ
          # é€™å€‹å‘½ä»¤æœƒå°‡ç•¶å‰ Python ç’°å¢ƒè¨»å†Šç‚º Jupyter/Papermill å¯ä»¥ä½¿ç”¨çš„ 'python3' æ ¸å¿ƒ
          python -m ipykernel install --user --name=python3 --display-name="Python 3"

      # ... (ä¸‹è¼‰æª”æ¡ˆçš„æ­¥é©Ÿ - ç¢ºä¿ä¸‹è¼‰å¾Œçš„æª”æ¡ˆåç¨±æ˜¯ ollama_github.ipynb)

      - name: Execute Colab Notebook with Papermill  # ğŸš€ ä½¿ç”¨ Papermill
        run: |
          papermill ollama_github.ipynb executed_output.ipynb
        # âŒ æ³¨æ„ï¼šæ‚¨**ä¸**æ‡‰è©²åŸ·è¡Œï¼š
        # run: python ollama_github.ipynb
     
